apiVersion: v1
kind: Namespace
metadata:
  name: alb
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: alb-controller
  namespace: argocd
  finalizers:
    - resources-finalizer.argocd.argoproj.io
spec:
  project: admins
  source:
    chart: aws-load-balancer-controller
    repoURL: https://aws.github.io/eks-charts
    targetRevision: 1.6.2
    helm:
      releaseName: aws-load-balancer-controller
      parameters:
        - name: serviceAccount.annotations.eks\.amazonaws\.com/role-arn
          value: ALB_ROLE_ARN
        - name: serviceAccount.annotations.eks\.amazonaws\.com/sts-regional-endpoints
          value: "true"
          forceString: true
        - name: serviceAccount.create
          value: "true"
        - name: serviceAccount.name
          value: "aws-load-balancer-controller"
        - name: clusterName
          value: CLUSTER_NAME
        - name: resources.limits.memory
          value: "128Mi"
        - name: resources.requests.cpu
          value: "100m"
        - name: resources.requests.memory
          value: "128Mi"
        - name: 'tolerations[0].key'
          value: CriticalAddonsOnly
        - name: 'tolerations[0].operator'
          value: Exists
# NOTE: Currently disabled however may need to bring back to limit aws lb controller.
#        - name: watchNamespace
#          value: "ingress-nginx"
  ignoreDifferences:
    - kind: Secret
      name: aws-load-balancer-tls
      jqPathExpressions:
        - .data

  destination:
    namespace: alb
    name: in-cluster
  syncPolicy:
    automated: {}
